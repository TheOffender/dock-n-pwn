#!/bin/bash
# This script adds the "vuln-net" network to all Vulhub docker-compose.yml files.
# It does two things for each file:
# 1. After each "image:" line, it inserts:
#      networks:
#         - vuln-net
# 2. If there is no top-level "networks:" section, it appends:
#
# networks:
#   vuln-net:
#     driver: bridge
#
# Usage: ./add_vuln_net.sh

find . -type f -name "docker-compose.yml" | while read file; do
  echo "Processing $file ..."
  
  # Insert the service-level networks block after each line that contains "image:"
  sed -i.bak '/^[[:space:]]*image:/ {
a\
   networks:\
      - vuln-net
}' "$file"

  # Append the top-level networks section if not present.
  if ! grep -q "^networks:" "$file"; then
    echo -e "\nnetworks:\n  vuln-net:\n    driver: bridge" >> "$file"
  fi
done

echo "Done."

